///////////////////////////////////////////////////////////////////////////////////////////////
// ОСНОВНЫЕ ДЕЙСТВИЯ ОБРАБОТКИ

Функция СохранитьДанные()
	
	ХранилищеОбщихНастроек.Сохранить("bnОкруглениеДатыВыгрузки", , ОкруглениеДатыВыгрузки);
	ХранилищеОбщихНастроек.Сохранить("bnКонтролироватьПорядокОбъектовПередВыгрузкой", , КонтролироватьПорядокОбъектовПередВыгрузкой);
	
	ОбновитьПовторноИспользуемыеЗначения();
	Модифицированность = Ложь;
	Возврат Истина;
	
КонецФункции

Процедура ОсновныеДействияФормыОК(Кнопка)
	
	СохранитьДанные();
	ЭтаФорма.Закрыть();
	
КонецПроцедуры

Процедура ПроверитьНеобходимостьИзмененияПорядкаОбъектов()
	
	НеобходимоОбновление = bnГитфлоу.ТребуетсяКорректировкаПорядкаОбъектовКонвертации(Конвертация);
	
	Индикатор = ЭлементыФормы.НадписьИндикацияКорректностиПорядка;
	
	Если НеобходимоОбновление Тогда
		
		Индикатор.Заголовок = НСтр("ru = 'Необходимо обновить порядок объектов'");
		Индикатор.ЦветТекста = WebЦвета.Красный;
		ЭлементыФормы.ОбновитьПорядок.Доступность = Истина;
		
	Иначе
		
		Индикатор.Заголовок = НСтр("ru = 'Корректировка порядка выгрузки не требуется'");
		Индикатор.ЦветТекста = WebЦвета.Зеленый;
		ЭлементыФормы.ОбновитьПорядок.Доступность = Ложь;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбновитьПорядокНажатие(Элемент)
	
	bnГитфлоу.ОбновитьПорядокОбъектовКонвертации(Конвертация);
	ПроверитьНеобходимостьИзмененияПорядкаОбъектов();
	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриОткрытии()
	
	ОкруглениеДатыВыгрузки = bnГитфлоуПовтИсп.ПолучитьЗначениеНастройки("bnОкруглениеДатыВыгрузки", 0);
	КонтролироватьПорядокОбъектовПередВыгрузкой = bnГитфлоуПовтИсп.ПолучитьЗначениеНастройки("bnКонтролироватьПорядокОбъектовПередВыгрузкой", Ложь);
	
	ПроверитьНеобходимостьИзмененияПорядкаОбъектов();
	
КонецПроцедуры

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Если Модифицированность Тогда
		Ответ = Вопрос(НСтр("ru = 'Данные были изменены. Сохранить изменения?'"), РежимДиалогаВопрос.ДаНетОтмена);
		Если Ответ = КодВозвратаДиалога.Да Тогда
			Если НЕ СохранитьДанные() Тогда
				Отказ = Истина;
			КонецЕсли;
		ИначеЕсли Ответ = КодВозвратаДиалога.Отмена Тогда
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
