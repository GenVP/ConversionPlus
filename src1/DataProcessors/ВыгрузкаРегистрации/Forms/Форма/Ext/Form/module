////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриОткрытии()
	
	ВосстановитьИнформациюОНастройках();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ КОМАНДНОЙ ПАНЕЛИ ОсновныеДействияФормы

Процедура ОсновныеДействияФормыСохранить(Кнопка)
	
	ВыполнитьВыгрузкуПравил();
	
	Если ФлагОшибки Тогда
		
		СтрокаСообщения = "В процессе выгрузки правил были обнаружены ошибки! Выгрузка не выполнена.";
		
	Иначе
		
		СтрокаСообщения = "Выгрузка правил регистрации успешно завершена.";
		
		СохранитьИнформациюОНастройках();
		
	КонецЕсли;
	
	Предупреждение(СтрокаСообщения);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ

// Процедура - обработчик события "НачалоВыбора" поля ввода имени файла правил.
//
Процедура ИмяФайлаПравилНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	Если СжиматьФайлПравил Тогда
		Фильтр     = "Архивный файл правил (*.zip)|*.zip";
		Расширение = "zip";
	Иначе
		Фильтр     = "Файл правил (*.xml)|*.xml";
		Расширение = "xml";
	КонецЕсли;
	
	ПолноеИмяПоУмолчанию = "ПравилаРегистрацииОбъектов";
	
	Если Не РегистрацияДляВыгрузки.Пустая() И Не РегистрацияДляВыгрузки.ПланОбмена.Пустая() Тогда
		
		ПолноеИмяПоУмолчанию = РегистрацияДляВыгрузки.ПланОбмена.Имя;
		
	КонецЕсли;
	
	РаботаСФайлами.глВыборФайла(Элемент, Ложь, Фильтр, Расширение, "Выберите имя файла для сохранения правил", ПолноеИмяПоУмолчанию);
	
КонецПроцедуры

// Процедура - обработчик события "Открытие" поля ввода имени файла правил.
//
Процедура ИмяФайлаПравилОткрытие(Элемент, СтандартнаяОбработка)
	
	РаботаСФайлами.глОткрытьФайл(ИмяФайлаПравил, СтандартнаяОбработка);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ

Процедура СохранитьИнформациюОНастройках()
	
	Если НЕ ЗначениеЗаполнено(РегистрацияДляВыгрузки) Тогда
		Возврат;
	КонецЕсли;
	
	РаботаСФайлами.УстановитьИмяФайла(РегистрацияДляВыгрузки, глТекущийПользователь, ИмяФайлаПравил);
	
КонецПроцедуры

Процедура ВосстановитьИнформациюОНастройках()
	
	ИмяФайлаПравил = РаботаСФайлами.ПолучитьИмяФайла(РегистрацияДляВыгрузки, глТекущийПользователь);
	
	СжиматьФайлПравил = ВРег(Прав(ИмяФайлаПравил, 4)) = ".ZIP";
	
КонецПроцедуры